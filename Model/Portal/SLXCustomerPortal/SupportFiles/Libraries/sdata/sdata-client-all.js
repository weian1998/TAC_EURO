/*
 * deps
 */
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};if(typeof(XML)=="undefined"){XML=function(){}}XML.ObjTree=function(){return this};XML.ObjTree.VERSION="0.24";XML.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n';XML.ObjTree.prototype.attr_prefix="-";XML.ObjTree.prototype.overrideMimeType="text/xml";XML.ObjTree.prototype.parseXML=function(c){var b;if(window.DOMParser){var a=new DOMParser();var d=a.parseFromString(c,"application/xml");if(!d){return}b=d.documentElement}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async=false;a.loadXML(c);b=a.documentElement}}if(!b){return}return this.parseDOM(b)};XML.ObjTree.prototype.parseHTTP=function(b,j,h){var a={};for(var g in j){a[g]=j[g]}if(!a.method){if(typeof(a.postBody)=="undefined"&&typeof(a.postbody)=="undefined"&&typeof(a.parameters)=="undefined"){a.method="get"}else{a.method="post"}}if(h){a.asynchronous=true;var f=this;var c=h;var d=a.onComplete;a.onComplete=function(l){var k;if(l&&l.responseXML&&l.responseXML.documentElement){k=f.parseDOM(l.responseXML.documentElement)}else{if(l&&l.responseText){k=f.parseXML(l.responseText)}}c(k,l);if(d){d(l)}}}else{a.asynchronous=false}var i;if(typeof(HTTP)!="undefined"&&HTTP.Request){a.uri=b;var e=new HTTP.Request(a);if(e){i=e.transport}}else{if(typeof(Ajax)!="undefined"&&Ajax.Request){var e=new Ajax.Request(b,a);if(e){i=e.transport}}}if(h){return i}if(i&&i.responseXML&&i.responseXML.documentElement){return this.parseDOM(i.responseXML.documentElement)}else{if(i&&i.responseText){return this.parseXML(i.responseText)}}};XML.ObjTree.prototype.parseDOM=function(a){if(!a){return}this.__force_array={};if(this.force_array){for(var d=0;d<this.force_array.length;d++){this.__force_array[this.force_array[d]]=1}}var c=this.parseElement(a);if(this.__force_array[a.nodeName]){c=[c]}if(a.nodeType!=11){var b={};b[a.nodeName]=c;c=b}return c};XML.ObjTree.prototype.parseElement=function(e){if(e.nodeType==7){return}if(e.nodeType==3||e.nodeType==4){var f=e.nodeValue.match(/[^\x00-\x20]/);if(f==null){return}return e.nodeValue}var b;var d={};if(e.attributes&&e.attributes.length){b={};for(var g=0;g<e.attributes.length;g++){var j=e.attributes[g].nodeName;if(typeof(j)!="string"){continue}var c=e.attributes[g].nodeValue;if(!c){continue}j=this.attr_prefix+j;if(typeof(d[j])=="undefined"){d[j]=0}d[j]++;this.addNode(b,j,d[j],c)}}if(e.childNodes&&e.childNodes.length){var h=true;if(b){h=false}for(var g=0;g<e.childNodes.length&&h;g++){var a=e.childNodes[g].nodeType;if(a==3||a==4){continue}h=false}if(h){if(!b){b=""}for(var g=0;g<e.childNodes.length;g++){b+=e.childNodes[g].nodeValue}}else{if(!b){b={}}for(var g=0;g<e.childNodes.length;g++){var j=e.childNodes[g].nodeName;if(typeof(j)!="string"){continue}var c=this.parseElement(e.childNodes[g]);if(!c){continue}if(typeof(d[j])=="undefined"){d[j]=0}d[j]++;this.addNode(b,j,d[j],c)}}}return b};XML.ObjTree.prototype.addNode=function(c,a,b,d){if(this.__force_array[a]){if(b==1){c[a]=[]}c[a][c[a].length]=d}else{if(b==1){c[a]=d}else{if(b==2){c[a]=[c[a],d]}else{c[a][c[a].length]=d}}}};XML.ObjTree.prototype.writeXML=function(a){var b=this.hash_to_xml(null,a);return this.xmlDecl+b};XML.ObjTree.prototype.hash_to_xml=function(c,b){var f=[];var a=[];for(var e in b){if(!b.hasOwnProperty(e)){continue}var h=b[e];if(e.charAt(0)!=this.attr_prefix){if(typeof(h)=="undefined"||h==null){f[f.length]="<"+e+" />"}else{if(typeof(h)=="object"&&h.constructor==Array){f[f.length]=this.array_to_xml(e,h)}else{if(typeof(h)=="object"){f[f.length]=this.hash_to_xml(e,h)}else{f[f.length]=this.scalar_to_xml(e,h)}}}}else{a[a.length]=" "+(e.substring(1))+'="'+(this.xml_escape(h))+'"'}}var g=a.join("");var d=f.join("");if(typeof(c)=="undefined"||c==null){}else{if(f.length>0){if(d.match(/\n/)){d="<"+c+g+">\n"+d+"</"+c+">\n"}else{d="<"+c+g+">"+d+"</"+c+">\n"}}else{d="<"+c+g+" />\n"}}return d};XML.ObjTree.prototype.array_to_xml=function(b,e){var a=[];for(var c=0;c<e.length;c++){var d=e[c];if(typeof(d)=="undefined"||d==null){a[a.length]="<"+b+" />"}else{if(typeof(d)=="object"&&d.constructor==Array){a[a.length]=this.array_to_xml(b,d)}else{if(typeof(d)=="object"){a[a.length]=this.hash_to_xml(b,d)}else{a[a.length]=this.scalar_to_xml(b,d)}}}}return a.join("")};XML.ObjTree.prototype.scalar_to_xml=function(a,b){if(a=="#text"){return this.xml_escape(b)}else{return"<"+a+">"+this.xml_escape(b)+"</"+a+">\n"}};XML.ObjTree.prototype.xml_escape=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};

/*
 * sdata-client
 */
(function(){
var d=Sage,a=Sage.namespace("Sage.SData.Client.Ajax");var f=function(g){return((g>=200&&g<300)||g===304)};var b=function(k,j){if(k.readyState==4){if(f(k.status)){if(j.success){j.success.call(j.scope||this,k,j)}}else{if(k.status===0){var i=false;try{i=(k.statusText==="")}catch(g){i=true}if(i){var h=j.aborted||j.failure;if(h){h.call(j.scope||this,k,j)}}else{if(j.failure){j.failure.call(j.scope||this,k,j)}}}else{if(j.failure){j.failure.call(j.scope||this,k,j)}}}}};var c=function(h,g){h.onreadystatechange=function(){b.call(h,h,g)}};var e=function(h){var g=[];for(var i in h){g.push(encodeURIComponent(i)+"="+encodeURIComponent(h[i]))}return g.join("&")};Sage.apply(Sage.SData.Client.Ajax,{request:function(j){var j=d.apply({},j);j.params=d.apply({},j.params);j.headers=d.apply({},j.headers);if(j.cache!==false){j.params[j.cacheParam||"_t"]=(new Date()).getTime()}j.method=j.method||"GET";var g=e(j.params);if(g){j.url=j.url+(/\?/.test(j.url)?"&":"?")+g}var i=new XMLHttpRequest();if(j.user){i.open(j.method,j.url,j.async!==false,j.user,j.password);i.withCredentials=true}else{i.open(j.method,j.url,j.async!==false)}try{i.setRequestHeader("Accept",j.accept||"*/*");i.setRequestHeader("X-Requested-With","XMLHttpRequest");if(j.contentType){i.setRequestHeader("Content-Type",j.contentType)}for(var k in j.headers){i.setRequestHeader(k,j.headers[k])}}catch(h){}if(j.async!==false){c(i,j);i.send(j.body||null)}else{i.send(j.body||null);b(i,j)}return i},cancel:function(g){g.abort()}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataBaseRequest=Sage.Class.define({service:null,uri:null,completeHeaders:null,extendedHeaders:null,constructor:function(c){this.base.apply(this,arguments);this.service=c;this.completeHeaders={};this.extendedHeaders={};this.uri=new Sage.SData.Client.SDataUri();if(this.service){this.uri.setVersion(this.service.getVersion());this.uri.setIncludeContent(this.service.getIncludeContent());this.uri.setServer(this.service.getVirtualDirectory()?this.service.getVirtualDirectory():"sdata");this.uri.setScheme(this.service.getProtocol());this.uri.setHost(this.service.getServerName());this.uri.setPort(this.service.getPort())}},clone:function(){return new Sage.SData.Client.SDataBaseRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},setRequestHeader:function(c,d){this.completeHeaders[c]=d},extendRequestHeader:function(c,d){this.extendedHeaders[c]=d},clearRequestHeader:function(c){delete this.completeHeaders[c];delete this.extendedHeaders[c]},getAccept:function(){return this.extendedHeaders.Accept},setAccept:function(c){this.extendRequestHeader("Accept",c);return this},getService:function(){return this.service},getUri:function(){return this.uri},setUri:function(c){this.uri=c;return this},getServerName:function(){return this.uri.getHost()},setServerName:function(c){this.uri.setHost(c);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(c){this.uri.setServer(c);return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(c){this.uri.setScheme(c);return this},getPort:function(){return this.uri.getPort()},setPort:function(c){this.uri.setPort(c);return this},getQueryArgs:function(){return this.uri.getQueryArgs()},setQueryArgs:function(d,c){this.uri.setQueryArgs(d,c);return this},getQueryArg:function(c){return this.uri.getQueryArg(c)},setQueryArg:function(c,d){this.uri.setQueryArg(c,d);return this},build:function(c){return this.uri.build(c)},toString:function(c){return this.build(c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataApplicationRequest=Sage.SData.Client.SDataBaseRequest.extend({constructor:function(){this.base.apply(this,arguments);if(this.service){this.uri.setProduct(this.service.getApplicationName()?this.service.getApplicationName():"-");this.uri.setContract(this.service.getContractName()?this.service.getContractName():"-");this.uri.setCompanyDataset(this.service.getDataSet()?this.service.getDataSet():"-")}},clone:function(){return new Sage.SData.Client.SDataApplicationRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(c){this.uri.setProduct(c);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(c){this.uri.setContract(c);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(c){this.uri.setCompanyDataset(c);return this},getResourceKind:function(){return this.uri.getCollectionType()},setResourceKind:function(c){this.uri.setCollectionType(c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataResourceCollectionRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataResourceCollectionRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getCount:function(){return this.uri.getCount()},setCount:function(c){this.uri.setCount(c);return this},getStartIndex:function(){return this.uri.getStartIndex()},setStartIndex:function(c){this.uri.setStartIndex(c);return this},read:function(c){return this.service.readFeed(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataNamedQueryRequest=Sage.SData.Client.SDataResourceCollectionRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex,b.SDataUri.NamedQuerySegment)},clone:function(){return new Sage.SData.Client.SDataNamedQueryRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getQueryName:function(){return this.uri.getPathSegment(b.SDataUri.ResourcePropertyIndex+1)},setQueryName:function(c){this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex+1,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataSingleResourceRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataSingleResourceRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},read:function(c){return this.service.readEntry(this,c)},update:function(d,c){return this.service.updateEntry(this,d,c)},create:function(d,c){return this.service.createEntry(this,d,c)},"delete":function(d,c){return this.service.deleteEntry(this,d,c)},getResourceSelector:function(){return this.uri.getCollectionPredicate()},setResourceSelector:function(c){this.uri.setCollectionPredicate(c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataResourcePropertyRequest=Sage.SData.Client.SDataSingleResourceRequest.extend({constructor:function(){this.base.apply(this,arguments)},clone:function(){return new Sage.SData.Client.SDataResourcePropertyRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},readFeed:function(c){return this.service.readFeed(this,c)},getResourceProperty:function(){return this.uri.getPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex)},setResourceProperty:function(c){this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataSystemRequest=Sage.SData.Client.SDataBaseRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(Sage.SData.Client.SDataUri.ProductPathIndex,Sage.SData.Client.SDataUri.SystemSegment)},clone:function(){return new Sage.SData.Client.SDataSystemRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},getCategory:function(){this.uri.getPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex)},setCategory:function(c){this.uri.setPathSegment(Sage.SData.Client.SDataUri.ContractTypePathIndex,c);return this},read:function(c){return this.service.readFeed(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataTemplateResourceRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,Sage.SData.Client.SDataUri.TemplateSegment)},clone:function(){return new Sage.SData.Client.SDataTemplateResourceRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},read:function(c){return this.service.readEntry(this,c)}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataServiceOperationRequest=Sage.SData.Client.SDataApplicationRequest.extend({constructor:function(){this.base.apply(this,arguments);this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex,b.SDataUri.ServiceMethodSegment)},clone:function(){return new Sage.SData.Client.SDataServiceOperationRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri))},execute:function(d,c){return this.service.executeServiceOperation(this,d,c)},getOperationName:function(){return this.uri.getPathSegment(b.SDataUri.ResourcePropertyIndex+1)},setOperationName:function(c){this.uri.setPathSegment(b.SDataUri.ResourcePropertyIndex+1,c);return this}})})();(function(){var a=Sage,b=Sage.namespace("Sage.SData.Client");Sage.SData.Client.SDataBatchRequest=Sage.SData.Client.SDataApplicationRequest.extend({items:null,constructor:function(){this.base.apply(this,arguments);this.items=[];this.uri.setPathSegment(Sage.SData.Client.SDataUri.ResourcePropertyIndex,Sage.SData.Client.SDataUri.BatchSegment)},clone:function(){return new Sage.SData.Client.SDataBatchRequest(this.service).setUri(new Sage.SData.Client.SDataUri(this.uri)).setItems(this.items.slice(0))},getItems:function(){return this.items},setItems:function(c){this.items=c;return this},using:function(d,c){if(this.service){this.service.registerBatchScope(this)}else{throw"A service must be associated with the batch request."}try{d.call(c||this,this)}catch(f){this.service.clearBatchScope(this);throw f}this.service.clearBatchScope(this);return this},add:function(c){this.items.push(c)},commit:function(c){this.service.commitBatch(this,c)}})})();(function(){var a=Sage,c=Sage.namespace("Sage.SData.Client"),b=/^true$/i;Sage.SData.Client.SDataUri=Sage.Class.define({scheme:"http",host:"",server:"",port:-1,version:null,queryArgs:null,pathSegments:null,constructor:function(d){this.base.apply(this,arguments);a.apply(this,d);this.queryArgs=a.apply({},d&&d.queryArgs);this.pathSegments=(d&&d.pathSegments&&d.pathSegments.slice(0))||[];this.version=(d&&d.version&&a.apply({},d.version))||{major:1,minor:0}},clone:function(){return new Sage.SData.Client.SDataUri(this)},getVersion:function(){return this.version},setVersion:function(d){this.version=a.apply({major:0,minor:0},d);return this},getScheme:function(){return this.scheme},setScheme:function(d){this.scheme=d;return this},getHost:function(){return this.host},setHost:function(d){this.host=d;return this},getPort:function(){return this.port},setPort:function(d){this.port=d;return this},getServer:function(){return this.server},setServer:function(d){this.server=d;return this},getQueryArgs:function(){return this.queryArgs},setQueryArgs:function(e,d){this.queryArgs=d?e:a.apply(this.queryArgs,e);return this},getQueryArg:function(d){return this.queryArgs[d]},setQueryArg:function(d,e){this.queryArgs[d]=e;return this},getPathSegments:function(){return this.pathSegments},setPathSegments:function(d){this.pathSegments=d;return this},getPathSegment:function(d){return this.pathSegments.length>d?this.pathSegments[d]:false},setPathSegment:function(e,g,d){if(!g&&!d){this.pathSegments[e]=null}else{if(typeof g==="object"){this.pathSegments[e]=a.apply({},g,this.pathSegments[e])}else{var f={};if(g){f.text=g}if(d){f.predicate=d}this.pathSegments[e]=a.apply({},f,this.pathSegments[e])}}return this},getStartIndex:function(){return this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]?parseInt(this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]):-1},setStartIndex:function(d){this.queryArgs[c.SDataUri.QueryArgNames.StartIndex]=d;return this},getCount:function(){return this.queryArgs[c.SDataUri.QueryArgNames.Count]?parseInt(this.queryArgs[c.SDataUri.QueryArgNames.Count]):-1},setCount:function(d){this.queryArgs[c.SDataUri.QueryArgNames.Count]=d;return this},getIncludeContent:function(){var d=this.version.major>=1?c.SDataUri.QueryArgNames.IncludeContent:c.SDataUri.QueryArgNames.LegacyIncludeContent;return b.test(this.queryArgs[d])},setIncludeContent:function(e){var d=this.version.major>=1?c.SDataUri.QueryArgNames.IncludeContent:c.SDataUri.QueryArgNames.LegacyIncludeContent;this.queryArgs[d]=""+e;return this},appendPath:function(e){var d=typeof e==="string"?{text:e}:e;this.pathSegments.push(d);return this},toString:function(d){return this.build(d)},build:function(e){var d=[];d.push(this.getScheme()||c.SDataUri.Http);d.push(c.SDataUri.SchemeSuffix);d.push(c.SDataUri.PathSegmentPrefix);d.push(c.SDataUri.PathSegmentPrefix);d.push(this.getHost());if(this.getPort()>0){d.push(c.SDataUri.PortPrefix,this.getPort())}d.push(c.SDataUri.PathSegmentPrefix);var j=this.getPathSegments();var n=[];var g=this.getServer();if(g&&g.length>0){n=n.concat(g.split("/"))}for(var h=0;h<j.length;h++){var k=j[h];if(k&&k.text){if(k.predicate){n.push(encodeURIComponent(k.text+"("+k.predicate+")"))}else{n.push(encodeURIComponent(k.text))}}}d.push(n.join(c.SDataUri.PathSegmentPrefix));if(e){return d.join("")}var f=this.getQueryArgs();var l=[];for(var m in f){l.push(encodeURIComponent(m)+c.SDataUri.QueryArgValuePrefix+encodeURIComponent(f[m]))}if(l.length>0){d.push(c.SDataUri.QueryPrefix);d.push(l.join(c.SDataUri.QueryArgPrefix))}return d.join("")},getProduct:function(){return this.getPathSegment(c.SDataUri.ProductPathIndex)},setProduct:function(d){return this.setPathSegment(c.SDataUri.ProductPathIndex,d)},getContract:function(){return this.getPathSegment(c.SDataUri.ContractTypePathIndex)},setContract:function(d){return this.setPathSegment(c.SDataUri.ContractTypePathIndex,d)},getCompanyDataset:function(){return this.getPathSegment(c.SDataUri.CompanyDatasetPathIndex)},setCompanyDataset:function(d){return this.setPathSegment(c.SDataUri.CompanyDatasetPathIndex,d)},getCollectionType:function(){return this.getPathSegment(c.SDataUri.CollectionTypePathIndex)},setCollectionType:function(d){return this.setPathSegment(c.SDataUri.CollectionTypePathIndex,d)},getCollectionPredicate:function(){var d=this.getPathSegment(c.SDataUri.CollectionTypePathIndex);return(d&&d.predicate)||false},setCollectionPredicate:function(d){return this.setPathSegment(c.SDataUri.CollectionTypePathIndex,{predicate:d})}});Sage.apply(Sage.SData.Client.SDataUri,{Http:"http",Https:"https",PathSegmentPrefix:"/",PortPrefix:":",QueryArgPrefix:"&",QueryArgValuePrefix:"=",QueryPrefix:"?",SchemeSuffix:":",UnspecifiedPort:-1,UriName:"uri",QueryArgNames:{Count:"count",Exclude:"exclude",Format:"format",Include:"include",IncludeContent:"_includeContent",LegacyIncludeContent:"includeContent",IncludeSchema:"includeSchema",Language:"language",OrderBy:"orderby",Precedence:"precedence",ReturnDelta:"returnDelta",Search:"search",Select:"select",StartIndex:"startIndex",Thumbnail:"thumbnail",TrackingID:"trackingID",Where:"where"},ProductPathIndex:0,ContractTypePathIndex:1,CompanyDatasetPathIndex:2,CollectionTypePathIndex:3,ResourcePropertyIndex:4,ServiceMethodSegment:"$service",TemplateSegment:"$template",SystemSegment:"$system",NamedQuerySegment:"$queries",BatchSegment:"$batch"})})();(function(){var b=Sage,d=Sage.namespace("Sage.SData.Client"),a=function(e){return typeof e!=="undefined"},c=/^(.+?):(.*)$/;Sage.SData.Client.SDataService=Sage.Evented.extend({uri:null,useCredentialedRequest:false,userAgent:"Sage",userName:false,password:"",batchScope:null,constructor:function(e){this.base.apply(this,arguments);this.uri=new Sage.SData.Client.SDataUri();if(e){if(a(e.uri)){this.uri=new Sage.SData.Client.SDataUri(e.uri)}if(a(e.version)){this.uri.setVersion(e.version)}if(a(e.serverName)){this.uri.setHost(e.serverName)}if(a(e.virtualDirectory)){this.uri.setServer(e.virtualDirectory)}if(a(e.applicationName)){this.uri.setProduct(e.applicationName)}if(a(e.contractName)){this.uri.setContract(e.contractName)}if(a(e.dataSet)){this.uri.setCompanyDataset(e.dataSet)}if(a(e.port)){this.uri.setPort(e.port)}if(a(e.protocol)){this.uri.setScheme(e.protocol)}if(a(e.includeContent)){this.uri.setIncludeContent(e.includeContent)}if(a(e.json)){this.json=e.json}if(a(e.userName)){this.userName=e.userName}if(a(e.password)){this.password=e.password}if(a(e.useCredentialedRequest)){this.useCredentialedRequest=e.useCredentialedRequest}}this.addEvents("beforerequest","requestcomplete","requestexception","requestaborted")},isJsonEnabled:function(){return this.json},enableJson:function(){this.json=true;return this},disableJson:function(){this.json=false;return this},getVersion:function(){return this.uri.getVersion()},setVersion:function(e){this.uri.setVersion(e);return this},getUri:function(){return this.uri},getUserName:function(){return this.userName},setUserName:function(e){this.userName=e;return this},getPassword:function(){return this.password},setPassword:function(e){this.password=e;return this},getProtocol:function(){return this.uri.getScheme()},setProtocol:function(e){this.uri.setScheme(e);return this},getServerName:function(){return this.uri.getHost()},setServerName:function(e){this.uri.setHost(e);return this},getPort:function(){return this.uri.getPort()},setPort:function(e){this.uri.setPort(e);return this},getVirtualDirectory:function(){return this.uri.getServer()},setVirtualDirectory:function(e){this.uri.setServer(e);return this},getApplicationName:function(){return this.uri.getProduct()},setApplicationName:function(e){this.uri.setProduct(e);return this},getContractName:function(){return this.uri.getContract()},setContractName:function(e){this.uri.setContract(e);return this},getDataSet:function(){return this.uri.getCompanyDataset()},setDataSet:function(e){this.uri.setCompanyDataset(e);return this},getIncludeContent:function(){return this.uri.getIncludeContent()},setIncludeContent:function(e){this.uri.setIncludeContent(e);return this},getUserAgent:function(){return this.userAgent},setUserAgent:function(e){this.userAgent=e;return this},registerBatchScope:function(e){this.batchScope=e},clearBatchScope:function(e){this.batchScope=null},createBasicAuthToken:function(){return"Basic "+Base64.encode(this.userName+":"+this.password)},createHeadersForRequest:function(e){var f={"X-Authorization-Mode":"no-challenge"};if(this.userName&&!this.useCredentialedRequest){f.Authorization=f["X-Authorization"]=this.createBasicAuthToken()}return f},extendAcceptRequestHeader:function(e,f){if(e){return e.split(/\s*,\s*/).join(";"+f+",")+";"+f}return e},executeRequest:function(f,e,g){if(this.json){f.setQueryArg("format","json")}var h=b.apply({async:e.async,headers:{},method:"GET",url:f.build()},{scope:this,success:function(i,j){var k=this.processFeed(i);this.fireEvent("requestcomplete",f,j,k);if(e.success){e.success.call(e.scope||this,k)}},failure:function(i,j){this.fireEvent("requestexception",f,j,i);if(e.failure){e.failure.call(e.scope||this,i,j)}},aborted:function(i,j){this.fireEvent("requestaborted",f,j,i);if(e.aborted){e.aborted.call(e.scope||this,i,j)}}},g);b.apply(h.headers,this.createHeadersForRequest(f),f.completeHeaders);if(f.extendedHeaders.Accept){h.headers.Accept=this.extendAcceptRequestHeader(h.headers.Accept,f.extendedHeaders.Accept)}if(this.userName&&this.useCredentialedRequest){h.user=this.userName;h.password=this.password}this.fireEvent("beforerequest",f,h);if(typeof h.result!=="undefined"){if(e.success){e.success.call(e.scope||this,h.result)}return}return d.Ajax.request(h)},abortRequest:function(e){d.Ajax.cancel(e)},readFeed:function(f,e){e=e||{};if(this.batchScope){this.batchScope.add({url:f.build(),method:"GET"});return}var g={headers:{Accept:this.json?"application/json,*/*":"application/atom+xml;type=feed,*/*"}};if(e.httpMethodOverride){if(this.json){f.setQueryArg("format","json")}g.headers["X-HTTP-Method-Override"]="GET";g.method="POST";g.body=f.build();g.url=f.build(true)}return this.executeRequest(f,e,g)},readEntry:function(f,e){e=e||{};if(this.batchScope){this.batchScope.add({url:f.build(),method:"GET"});return}var g=b.apply({},{success:function(i){var h=i["$resources"][0]||false;if(e.success){e.success.call(e.scope||this,h)}}},e);return this.executeRequest(f,g,{headers:{Accept:this.json?"application/json,*/*":"application/atom+xml;type=entry,*/*"}})},createEntry:function(h,g,f){f=f||{};if(this.batchScope){this.batchScope.add({url:h.build(),entry:g,method:"POST"});return}var j=b.apply({},{success:function(l){var k=l["$resources"][0]||false;if(f.success){f.success.call(f.scope||this,k)}}},f);var i=b.apply({},{method:"POST"});if(this.isJsonEnabled()){b.apply(i,{body:JSON.stringify(g),headers:{"Content-Type":"application/json"}})}else{var e=new XML.ObjTree();e.attr_prefix="@";b.apply(i,{body:e.writeXML(this.formatEntry(g)),headers:{"Content-Type":"application/atom+xml;type=entry",Accept:"application/atom+xml;type=entry,*/*"}})}return this.executeRequest(h,j,i)},updateEntry:function(h,g,f){f=f||{};if(this.batchScope){this.batchScope.add({url:h.build(),entry:g,method:"PUT",etag:g["$etag"]});return}var k=b.apply({},{success:function(m){var l=m["$resources"][0]||false;if(f.success){f.success.call(f.scope||this,l)}}},f);var j={},i={method:"PUT",headers:j};if(g["$etag"]&&!(f&&f.ignoreETag)){j["If-Match"]=g["$etag"]}if(this.isJsonEnabled()){j["Content-Type"]="application/json";i.body=JSON.stringify(g)}else{var e=new XML.ObjTree();e.attr_prefix="@";j["Content-Type"]="application/atom+xml;type=entry";j.Accept="application/atom+xml;type=entry,*/*";i.body=e.writeXML(this.formatEntry(g))}return this.executeRequest(h,k,i)},deleteEntry:function(g,f,e){e=e||{};if(this.batchScope){this.batchScope.add({url:g.build(),method:"DELETE",etag:!(e&&e.ignoreETag)&&f["$etag"]});return}var i={},h={method:"DELETE",headers:i};if(f["$etag"]&&!(e&&e.ignoreETag)){i["If-Match"]=f["$etag"]}return this.executeRequest(g,e,h)},executeServiceOperation:function(h,g,f){var j=b.apply({},{success:function(m){var l=m["$resources"][0]||false,k=l&&l.response,o=k&&k["$resources"],n=o&&o[0];if(n&&n["$name"]){l.response={};l.response[n["$name"]]=n}if(f.success){f.success.call(f.scope||this,l)}}},f);var i=b.apply({},{method:"POST"});if(this.isJsonEnabled()){b.apply(i,{body:JSON.stringify(g),headers:{"Content-Type":"application/json"}})}else{var e=new XML.ObjTree();e.attr_prefix="@";b.apply(i,{body:e.writeXML(this.formatEntry(g)),headers:{"Content-Type":"application/atom+xml;type=entry",Accept:"application/atom+xml;type=entry,*/*"}})}return this.executeRequest(h,j,i)},commitBatch:function(e,n){n=n||{};var h=e.getItems(),m,k,l={"$resources":[]};for(var f=0;f<h.length;f++){m=h[f];k=b.apply({},m.entry);if(m.url){k["$url"]=m.url}if(m.etag){k["$ifMatch"]=m.etag}if(m.method){k["$httpMethod"]=m.method}delete k["$etag"];l["$resources"].push(k)}var j=b.apply({},{method:"POST"});if(this.isJsonEnabled()){b.apply(j,{body:JSON.stringify(l),headers:{"Content-Type":"application/json"}})}else{var g=new XML.ObjTree();g.attr_prefix="@";b.apply(j,{body:g.writeXML(this.formatFeed(l)),headers:{"Content-Type":"application/atom+xml;type=feed",Accept:"application/atom+xml;type=feed,*/*"}})}return this.executeRequest(e,n,j)},parseFeedXml:function(f){var e=new XML.ObjTree();e.attr_prefix="@";return e.parseXML(f)},isIncludedReference:function(f,e,g){return g.hasOwnProperty("@sdata:key")},isIncludedCollection:function(h,f,i){if(i.hasOwnProperty("@sdata:key")){return false}if(i.hasOwnProperty("@sdata:uri")||i.hasOwnProperty("@sdata:url")){return true}var j,g;for(var e in i){if(e[0]==="@"){continue}j=i[e];break}if(j){if(b.isArray(j)){g=j[0]}else{g=j}if(g&&g.hasOwnProperty("@sdata:key")){return true}}return false},convertEntity:function(j,e,g,f){f=f||{};f["$name"]=e;f["$key"]=g["@sdata:key"];f["$url"]=g["@sdata:uri"];f["$uuid"]=g["@sdata:uuid"];for(var m in g){if(m[0]==="@"){continue}var n=c.exec(m),h=n?n[1]:false,i=n?n[2]:m,k=g[m];if(typeof k==="object"){if(k.hasOwnProperty("@xsi:nil")){var l=null}else{if(this.isIncludedReference(h,i,k)){var l=this.convertEntity(h,i,k)}else{if(this.isIncludedCollection(h,i,k)){var l=this.convertEntityCollection(h,i,k)}else{l=this.convertCustomEntityProperty(h,i,k)}}}k=l}f[i]=k}return f},convertEntityCollection:function(k,e,g){for(var n in g){if(n[0]==="@"){continue}var o=c.exec(n),h=o?o[1]:false,j=o?o[2]:n,l=g[n];if(b.isArray(l)){var m=[];for(var f=0;f<l.length;f++){m.push(this.convertEntity(k,j,l[f]))}return{"$resources":m}}else{return{"$resources":[this.convertEntity(k,j,l)]}}break}return null},convertCustomEntityProperty:function(f,e,g){return g},formatEntity:function(g,f,i){i=i||{};if(f["$key"]){i["@sdata:key"]=f["$key"]}for(var e in f){if(e[0]==="$"){continue}var h=f[e];if(h==null){h={"@xsi:nil":"true"}}else{if(typeof h==="object"&&h.hasOwnProperty("$resources")){h=this.formatEntityCollection(g,h)}else{if(typeof h==="object"){h=this.formatEntity(g,h)}}}i[e]=h}return i},formatEntityCollection:function(h,k){var e={};for(var g=0;g<k["$resources"].length;g++){var j=k["$resources"][g],f=j["$name"],l=(e[f]=e[f]||[]);l.push(this.formatEntity(h,k["$resources"][g]))}return e},convertEntry:function(j){var e={};e["$descriptor"]=j.title;e["$etag"]=j["http:etag"];e["$httpStatus"]=j["http:httpStatus"];var l=j["sdata:payload"];for(var h in l){if(l.hasOwnProperty(h)==false){continue}var k=h.split(":"),i,g,f=l[h];if(k.length==2){i=k[0];g=k[1]}else{if(k.length<2){i=false;g=h}else{continue}}this.convertEntity(i,g,f,e)}return e},formatEntry:function(f,g){var e={};if(!g){e["@xmlns:sdata"]="http://schemas.sage.com/sdata/2008/1";e["@xmlns:xsi"]="http://www.w3.org/2001/XMLSchema-instance";e["@xmlns:http"]="http://schemas.sage.com/sdata/http/2008/1";e["@xmlns"]="http://www.w3.org/2005/Atom"}if(f["$httpMethod"]){e["http:httpMethod"]=f["$httpMethod"]}if(f["$ifMatch"]){e["http:ifMatch"]=f["$ifMatch"]}if(f["$etag"]){e["http:etag"]=f["$etag"]}if(f["$url"]){e.id=f["$url"]}e["sdata:payload"]={};e["sdata:payload"][f["$name"]]={"@xmlns":"http://schemas.sage.com/dynamic/2007"};this.formatEntity(false,f,e["sdata:payload"][f["$name"]]);return{entry:e}},convertFeed:function(g){var e={};if(g["opensearch:totalResults"]){e["$totalResults"]=parseInt(g["opensearch:totalResults"])}if(g["opensearch:startIndex"]){e["$startIndex"]=parseInt(g["opensearch:startIndex"])}if(g["opensearch:itemsPerPage"]){e["$itemsPerPage"]=parseInt(g["opensearch:itemsPerPage"])}if(g.link){e["$link"]={};for(var f=0;f<g.link.length;f++){e["$link"][g.link[f]["@rel"]]=g.link[f]["@href"]}if(e["$link"]["self"]){e["$url"]=e["$link"]["self"]}}e["$resources"]=[];if(b.isArray(g.entry)){for(var f=0;f<g.entry.length;f++){e["$resources"].push(this.convertEntry(g.entry[f]))}}else{if(typeof g.entry==="object"){e["$resources"].push(this.convertEntry(g.entry))}}return e},formatFeed:function(g){var e={};e["@xmlns:sdata"]="http://schemas.sage.com/sdata/2008/1";e["@xmlns:xsi"]="http://www.w3.org/2001/XMLSchema-instance";e["@xmlns:http"]="http://schemas.sage.com/sdata/http/2008/1";e["@xmlns"]="http://www.w3.org/2005/Atom";if(g["$url"]){e.id=g["$url"]}e.entry=[];for(var f=0;f<g["$resources"].length;f++){e.entry.push(this.formatEntry(g["$resources"][f],true)["entry"])}return{feed:e}},processFeed:function(e){if(!e.responseText){return null}var g=e.getResponseHeader&&e.getResponseHeader("Content-Type");if((g==="application/json")||(!g&&this.isJsonEnabled())){var f=JSON.parse(e.responseText);if(f.hasOwnProperty("$resources")){return f}else{return{"$resources":[f]}}}else{var f=this.parseFeedXml(e.responseText);if(f.hasOwnProperty("feed")){return this.convertFeed(f.feed)}else{if(f.hasOwnProperty("entry")){return{"$resources":[this.convertEntry(f.entry)]}}else{return false}}}}})})();