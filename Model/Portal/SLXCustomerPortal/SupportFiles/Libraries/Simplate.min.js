/*
 * simplate-js v1.1
 * Copyright 2010, Michael Morton
 *
 * MIT Licensed - See LICENSE.txt
 */
(function(r){var q=/^\s+|\s+$/g,p=/(,)/,i=/'/g,h=/\n/g,k=/&/g,m=/</g,l=/>/g,j=/"/g,c={},e={},g="is,ie".split(p).length!=3,a={tags:{begin:"{%",end:"%}"},allowWith:false},d=function(b,c,d){if(d)for(var a in d)b[a]=d[a];if(c)for(var a in c)b[a]=c[a];return b},n=function(a){return typeof a!=="string"?a:a.replace(k,"&amp;").replace(m,"&lt;").replace(l,"&gt;").replace(j,"&quot;")},o=function(a){return a.replace(i,"\\'").replace(h,"\\n")},t=function(a){return a.replace(q,"")},s=function(b,m){var f=m.tags.begin,h=m.tags.end;if(!g){var l=f+h,n=e[l]||(e[l]=new RegExp(f+"(.*?)"+h));return b.split(n)}var j=0,k=0,a=[];while((j=b.indexOf(f,k))!=-1&&(k=b.indexOf(h,j))!=-1){a[a.length]=j;a[a.length]=k}for(var d=[],i=0,c=0;c<a.length;c++){d[d.length]=b.substr(i,a[c]-i);i=a[c]+(c%2?h.length:f.length)}d.push(b.substr(i));return d},f=function(f,i){if(f.join)f=f.join("");if(c[f])return c[f];for(var i=d({},i,a),b=s(f,i),e=1;e<b.length;e+=2)if(b[e].length>0){var j=b[e].charAt(0),g=b[e].substr(1);switch(j){case"=":b[e]="__r.push("+g+");";break;case":":b[e]="__r.push(__s.encode("+g+"));";break;case"!":b[e]="__r.push("+t(g)+".apply(__v, __c));"}}for(var e=0;e<b.length;e+=2)b[e]="__r.push('"+o(b[e])+"');";b.unshift("var __r = [], $ = __v, $$ = __c, __s = Simplate;",a.allowWith?"with ($ || {}) {":"");b.push(a.allowWith?"}":"","return __r.join('');");var h;try{h=new Function("__v, __c",b.join(""))}catch(k){h=function(){return k.message}}return c[f]=h},b=function(a,b){this.fn=f(a,b)};d(b,{options:a,encode:n,make:f});d(b.prototype,{apply:function(b,a){return this.fn.call(a||this,b,a||b)}});r.Simplate=b})(window)